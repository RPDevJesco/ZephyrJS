<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>XTextArea Example</title>
    <script type="module">
        import('../core/XModules.js');
    </script>
    <style>
        :root {
            --x-accent: #4f46e5;
            --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial;
        }
        body {
            font-family: var(--font);
            margin: 24px;
            max-width: 800px;
        }
        .form-group {
            margin-bottom: 16px;
        }
        .row {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 16px;
            flex-wrap: wrap;
        }
        #output {
            background: #f8fafc;
            padding: 12px;
            border-radius: 6px;
            margin-top: 16px;
            font-family: monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .demo-section {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
        }
        .demo-section h3 {
            margin-top: 0;
            color: #374151;
        }
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
        .textarea-demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }
    </style>
</head>
<body>
<h1>XTextArea Examples</h1>

<div class="demo-section">
    <h3>Feedback Form</h3>
    <form id="feedback-form">
        <div class="form-grid">
            <x-input
                    id="feedback-name"
                    label="Your Name"
                    type="text"
                    placeholder="Enter your name"
                    required
                    value="">
            </x-input>

            <x-select
                    id="feedback-type"
                    label="Feedback Type"
                    placeholder="Select type"
                    required
                    options='[
            {"value":"bug","label":"Bug Report"},
            {"value":"feature","label":"Feature Request"},
            {"value":"improvement","label":"Improvement Suggestion"},
            {"value":"compliment","label":"Compliment"},
            {"value":"complaint","label":"Complaint"}
          ]'
                    value="">
            </x-select>
        </div>

        <div class="form-group">
            <x-textarea
                    id="feedback-description"
                    label="Description"
                    placeholder="Please describe your feedback in detail..."
                    required
                    auto-resize
                    show-count
                    max-length="1000"
                    rows="4"
                    value="">
            </x-textarea>
        </div>

        <div class="form-group">
            <x-textarea
                    id="feedback-steps"
                    label="Steps to Reproduce (for bugs)"
                    placeholder="1. First I did...&#10;2. Then I clicked...&#10;3. Finally I saw..."
                    rows="3"
                    value="">
            </x-textarea>
        </div>

        <div class="form-group">
            <x-checkbox
                    id="feedback-followup"
                    label="I would like to be contacted about this feedback"
                    value="allow_followup">
            </x-checkbox>
        </div>

        <div class="row">
            <x-button id="submit-feedback-btn" label="Submit Feedback" variant="primary"></x-button>
            <x-button id="reset-feedback-btn" label="Reset Form"></x-button>
        </div>
    </form>
</div>

<div class="demo-section">
    <h3>Textarea Feature Demos</h3>

    <div class="textarea-demo-grid">
        <div>
            <h4>Auto-resize with Character Count</h4>
            <x-textarea
                    id="auto-resize-demo"
                    label="Auto-resizing Textarea"
                    placeholder="Start typing... this textarea will grow automatically!"
                    auto-resize
                    show-count
                    max-length="500"
                    rows="2"
                    value="">
            </x-textarea>
        </div>

        <div>
            <h4>Fixed Size with Validation</h4>
            <x-textarea
                    id="fixed-demo"
                    label="Fixed Size Textarea"
                    placeholder="This textarea has a fixed size but shows character count"
                    required
                    show-count
                    max-length="200"
                    rows="4"
                    value="">
            </x-textarea>
        </div>

        <div>
            <h4>Large Text Area</h4>
            <x-textarea
                    id="large-demo"
                    label="Large Text Area"
                    placeholder="This is a larger textarea for longer content..."
                    rows="6"
                    value="">
            </x-textarea>
        </div>

        <div>
            <h4>Disabled State</h4>
            <x-textarea
                    id="disabled-demo"
                    label="Disabled Textarea"
                    value="This content cannot be edited because the textarea is disabled."
                    rows="3"
                    disabled>
            </x-textarea>
        </div>
    </div>

    <div class="row" style="margin-top: 24px;">
        <x-button id="insert-text-btn" label="Insert Text"></x-button>
        <x-button id="select-all-btn" label="Select All"></x-button>
        <x-button id="get-selection-btn" label="Get Selection"></x-button>
        <x-button id="set-error-btn" label="Set Error"></x-button>
        <x-button id="clear-error-btn" label="Clear Error"></x-button>
        <x-button id="toggle-auto-resize-btn" label="Toggle Auto-resize"></x-button>
    </div>
</div>

<div class="demo-section">
    <h3>Dynamic Content Loading</h3>

    <div class="form-group">
        <x-select
                id="template-select"
                label="Load Template"
                placeholder="Choose a template to load"
                options='[
          {"value":"email","label":"Email Template"},
          {"value":"letter","label":"Business Letter"},
          {"value":"report","label":"Bug Report Template"},
          {"value":"review","label":"Product Review"}
        ]'
                value="">
        </x-select>
    </div>

    <div class="form-group">
        <x-textarea
                id="template-textarea"
                label="Template Content"
                placeholder="Select a template above to load content..."
                auto-resize
                show-count
                max-length="2000"
                rows="5"
                value="">
        </x-textarea>
    </div>
</div>

<div id="output">
    <strong>Form State (DOM attributes):</strong><br>
    <div id="state-data"></div>
</div>

<script type="module">
    class TextareaFormController {
        constructor() {
            this.textareas = document.querySelectorAll('x-textarea');
            this.inputs = document.querySelectorAll('x-input');
            this.selects = document.querySelectorAll('x-select');
            this.checkboxes = document.querySelectorAll('x-checkbox');
            this.stateOutput = document.getElementById('state-data');

            this.templates = {
                email: `Subject: [Your Subject Here]

Dear [Recipient Name],

I hope this email finds you well. I am writing to...

[Your main message content goes here]

Thank you for your time and consideration.

Best regards,
[Your Name]`,

                letter: `[Your Name]
[Your Address]
[City, State ZIP Code]
[Email Address]
[Phone Number]

[Date]

[Recipient Name]
[Recipient Title]
[Company Name]
[Company Address]
[City, State ZIP Code]

Dear [Recipient Name],

I am writing to...

[Main content of your letter]

Thank you for your consideration.

Sincerely,
[Your Name]`,

                report: `**Bug Report**

**Summary:** [Brief description of the issue]

**Steps to Reproduce:**
1. [First step]
2. [Second step]
3. [Third step]

**Expected Result:** [What should happen]

**Actual Result:** [What actually happened]

**Environment:**
- Browser: [Browser name and version]
- Operating System: [OS name and version]
- Device: [Device type if applicable]

**Additional Information:** [Any other relevant details]`,

                review: `**Product Review**

**Overall Rating:** [1-5 stars]

**What I Liked:**
- [Positive point 1]
- [Positive point 2]
- [Positive point 3]

**What Could Be Improved:**
- [Improvement suggestion 1]
- [Improvement suggestion 2]

**Detailed Experience:**
[Share your detailed experience with the product]

**Would I Recommend?** [Yes/No and why]

**Final Thoughts:** [Summary of your overall impression]`
            };

            this.bindEvents();
            this.updateStateDisplay();
        }

        bindEvents() {
            // Listen to all form element changes
            [...this.textareas, ...this.inputs, ...this.selects, ...this.checkboxes].forEach(element => {
                const eventMap = {
                    'x-textarea': 'textarea-change',
                    'x-input': 'input-change',
                    'x-select': 'select-change',
                    'x-checkbox': 'checkbox-change'
                };

                const eventType = eventMap[element.tagName.toLowerCase()];

                element.addEventListener(eventType, () => {
                    this.updateStateDisplay();
                });
            });

            // Form controls
            document.getElementById('submit-feedback-btn').addEventListener('button-click', () => {
                this.handleFeedbackSubmit();
            });

            document.getElementById('reset-feedback-btn').addEventListener('button-click', () => {
                this.handleFeedbackReset();
            });

            // Demo controls
            document.getElementById('insert-text-btn').addEventListener('button-click', () => {
                this.insertDemoText();
            });

            document.getElementById('select-all-btn').addEventListener('button-click', () => {
                document.getElementById('auto-resize-demo').selectAll();
            });

            document.getElementById('get-selection-btn').addEventListener('button-click', () => {
                this.showSelection();
            });

            document.getElementById('set-error-btn').addEventListener('button-click', () => {
                document.getElementById('fixed-demo').setAttr('error', 'This is a custom error message');
            });

            document.getElementById('clear-error-btn').addEventListener('button-click', () => {
                document.getElementById('fixed-demo').removeAttribute('error');
            });

            document.getElementById('toggle-auto-resize-btn').addEventListener('button-click', () => {
                this.toggleAutoResize();
            });

            // Template selection
            document.getElementById('template-select').addEventListener('select-change', (e) => {
                this.loadTemplate(e.detail.value);
            });
        }

        handleFeedbackSubmit() {
            // Trigger validation
            const feedbackElements = [
                document.getElementById('feedback-name'),
                document.getElementById('feedback-type'),
                document.getElementById('feedback-description')
            ];

            feedbackElements.forEach(element => {
                element.dispatchEvent(new Event('blur'));
            });

            // Check for errors
            const hasErrors = feedbackElements.some(element =>
                element.hasAttribute('error')
            );

            if (hasErrors) {
                alert('Please fix validation errors before submitting');
                return;
            }

            // Collect feedback data
            const feedbackData = {
                name: document.getElementById('feedback-name').getAttribute('value'),
                type: document.getElementById('feedback-type').getAttribute('value'),
                description: document.getElementById('feedback-description').getAttribute('value'),
                steps: document.getElementById('feedback-steps').getAttribute('value'),
                allowFollowup: document.getElementById('feedback-followup').hasAttribute('checked')
            };

            console.log('Feedback submitted:', feedbackData);
            alert('Thank you for your feedback! Check console for details.');
        }

        handleFeedbackReset() {
            const feedbackElements = [
                'feedback-name', 'feedback-type', 'feedback-description',
                'feedback-steps', 'feedback-followup'
            ];

            feedbackElements.forEach(id => {
                const element = document.getElementById(id);
                if (element.tagName.toLowerCase() === 'x-checkbox') {
                    element.removeAttribute('checked');
                } else {
                    element.setAttr('value', '');
                }
                element.removeAttribute('error');
            });
        }

        insertDemoText() {
            const textarea = document.getElementById('auto-resize-demo');
            const demoTexts = [
                'This text was inserted programmatically! ',
                '🚀 You can insert emojis too! ',
                '\n\nNew line with more content!\n',
                'Watch the textarea auto-resize as content grows...'
            ];

            const randomText = demoTexts[Math.floor(Math.random() * demoTexts.length)];
            textarea.insertText(randomText);
        }

        showSelection() {
            const textarea = document.getElementById('auto-resize-demo');
            const selection = textarea.getSelection();

            if (selection.text) {
                alert(`Selected text: "${selection.text}"\nFrom position ${selection.start} to ${selection.end}`);
            } else {
                alert('No text selected. Please select some text first.');
            }
        }

        toggleAutoResize() {
            const textarea = document.getElementById('large-demo');

            if (textarea.hasAttribute('auto-resize')) {
                textarea.removeAttribute('auto-resize');
                document.getElementById('toggle-auto-resize-btn').setAttr('label', 'Enable Auto-resize');
            } else {
                textarea.setAttr('auto-resize', '');
                document.getElementById('toggle-auto-resize-btn').setAttr('label', 'Disable Auto-resize');
            }
        }

        loadTemplate(templateKey) {
            if (!templateKey || !this.templates[templateKey]) return;

            const textarea = document.getElementById('template-textarea');
            textarea.setAttr('value', this.templates[templateKey]);
        }

        updateStateDisplay() {
            const state = {
                textareas: {},
                inputs: {},
                selects: {},
                checkboxes: {}
            };

            // Collect textarea states
            this.textareas.forEach(textarea => {
                const value = textarea.getAttribute('value') || '';
                state.textareas[textarea.id] = {
                    value: value,
                    valueLength: value.length,
                    error: textarea.getAttribute('error') || null,
                    disabled: textarea.hasAttribute('disabled'),
                    required: textarea.hasAttribute('required'),
                    autoResize: textarea.hasAttribute('auto-resize'),
                    showCount: textarea.hasAttribute('show-count'),
                    maxLength: textarea.getAttribute('max-length') || null,
                    rows: textarea.getAttribute('rows') || '3'
                };
            });

            // Collect other form element states (abbreviated for space)
            this.inputs.forEach(input => {
                state.inputs[input.id] = {
                    value: input.getAttribute('value') || '',
                    error: input.getAttribute('error') || null
                };
            });

            this.selects.forEach(select => {
                state.selects[select.id] = {
                    value: select.getAttribute('value') || '',
                    error: select.getAttribute('error') || null
                };
            });

            this.checkboxes.forEach(checkbox => {
                state.checkboxes[checkbox.id] = {
                    checked: checkbox.hasAttribute('checked'),
                    error: checkbox.getAttribute('error') || null
                };
            });

            this.stateOutput.innerHTML = '<pre>' + JSON.stringify(state, null, 2) + '</pre>';
        }
    }

    // Initialize the form controller
    new TextareaFormController();

    // Demo: Auto-fill some content after load
    setTimeout(() => {
        console.log('Demo: Adding sample content to auto-resize textarea');
        const textarea = document.getElementById('auto-resize-demo');
        textarea.setAttr('value', 'This textarea automatically resizes as you type!\n\nTry adding more lines of text to see it grow.\n\nThe character count updates in real-time too.');
    }, 2000);

    // Demo: Show validation error
    setTimeout(() => {
        console.log('Demo: Setting validation error on required textarea');
        document.getElementById('fixed-demo').setAttr('error', 'Please provide more detailed information');
    }, 4000);

    // Clear demo error
    setTimeout(() => {
        console.log('Demo: Clearing validation error');
        document.getElementById('fixed-demo').removeAttribute('error');
    }, 7000);
</script>
</body>
</html>